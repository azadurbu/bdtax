<?php

class UserSignatureController extends Controller
{
	/**
	* @var string the default layout for the views. Defaults to '//layouts/column2', meaning
	* using two-column layout. See 'protected/views/layouts/column2.php'.
	*/
	public $layout='//layouts/columnLess';
	
	
	


	public function filters()
	{
		return array('accessControl',); // perform access control for CRUD operations

	}

	/**
	* Specifies the access control rules.
	* This method is used by the 'accessControl' filter.
	* @return array access control rules
	*/
	public function accessRules()
	{
		return array(
			array('allow', // allow authenticated user to perform 'create' and 'update' actions
				'actions' => array('index', 'entry'),
				'users' => array('@'),
				'expression' => '(Yii::app()->user->role==="superAdmin")||(Yii::app()->user->role==="customers")||(Yii::app()->user->role==="companyUser")||(Yii::app()->user->role==="companyAdmin")',
			),
		
			array('deny',  // deny all users
				'users'=>array('*'),
				),
			);
	}
	
	
	

	public function actionEntry()
	{  
		$blankimage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA8YAAADyCAYAAACPktznAAARwklEQVR4Xu3XQQEAAAgCMelf2iA3GzD8sHMECBAgQIAAAQIECBAgQCAssHB20QkQIECAAAECBAgQIECAwBnGnoAAAQIECBAgQIAAAQIE0gKGcbp+4QkQIECAAAECBAgQIEDAMPYDBAgQIECAAAECBAgQIJAWMIzT9QtPgAABAgQIECBAgAABAoaxHyBAgAABAgQIECBAgACBtIBhnK5feAIECBAgQIAAAQIECBAwjP0AAQIECBAgQIAAAQIECKQFDON0/cITIECAAAECBAgQIECAgGHsBwgQIECAAAECBAgQIEAgLWAYp+sXngABAgQIECBAgAABAgQMYz9AgAABAgQIECBAgAABAmkBwzhdv/AECBAgQIAAAQIECBAgYBj7AQIECBAgQIAAAQIECBBICxjG6fqFJ0CAAAECBAgQIECAAAHD2A8QIECAAAECBAgQIECAQFrAME7XLzwBAgQIECBAgAABAgQIGMZ+gAABAgQIECBAgAABAgTSAoZxun7hCRAgQIAAAQIECBAgQMAw9gMECBAgQIAAAQIECBAgkBYwjNP1C0+AAAECBAgQIECAAAEChrEfIECAAAECBAgQIECAAIG0gGGcrl94AgQIECBAgAABAgQIEDCM/QABAgQIECBAgAABAgQIpAUM43T9whMgQIAAAQIECBAgQICAYewHCBAgQIAAAQIECBAgQCAtYBin6xeeAAECBAgQIECAAAECBAxjP0CAAAECBAgQIECAAAECaQHDOF2/8AQIECBAgAABAgQIECBgGPsBAgQIECBAgAABAgQIEEgLGMbp+oUnQIAAAQIECBAgQIAAAcPYDxAgQIAAAQIECBAgQIBAWsAwTtcvPAECBAgQIECAAAECBAgYxn6AAAECBAgQIECAAAECBNIChnG6fuEJECBAgAABAgQIECBAwDD2AwQIECBAgAABAgQIECCQFjCM0/ULT4AAAQIECBAgQIAAAQKGsR8gQIAAAQIECBAgQIAAgbSAYZyuX3gCBAgQIECAAAECBAgQMIz9AAECBAgQIECAAAECBAikBQzjdP3CEyBAgAABAgQIECBAgIBh7AcIECBAgAABAgQIECBAIC1gGKfrF54AAQIECBAgQIAAAQIEDGM/QIAAAQIECBAgQIAAAQJpAcM4Xb/wBAgQIECAAAECBAgQIGAY+wECBAgQIECAAAECBAgQSAsYxun6hSdAgAABAgQIECBAgAABw9gPECBAgAABAgQIECBAgEBawDBO1y88AQIECBAgQIAAAQIECBjGfoAAAQIECBAgQIAAAQIE0gKGcbp+4QkQIECAAAECBAgQIEDAMPYDBAgQIECAAAECBAgQIJAWMIzT9QtPgAABAgQIECBAgAABAoaxHyBAgAABAgQIECBAgACBtIBhnK5feAIECBAgQIAAAQIECBAwjP0AAQIECBAgQIAAAQIECKQFDON0/cITIECAAAECBAgQIECAgGHsBwgQIECAAAECBAgQIEAgLWAYp+sXngABAgQIECBAgAABAgQMYz9AgAABAgQIECBAgAABAmkBwzhdv/AECBAgQIAAAQIECBAgYBj7AQIECBAgQIAAAQIECBBICxjG6fqFJ0CAAAECBAgQIECAAAHD2A8QIECAAAECBAgQIECAQFrAME7XLzwBAgQIECBAgAABAgQIGMZ+gAABAgQIECBAgAABAgTSAoZxun7hCRAgQIAAAQIECBAgQMAw9gMECBAgQIAAAQIECBAgkBYwjNP1C0+AAAECBAgQIECAAAEChrEfIECAAAECBAgQIECAAIG0gGGcrl94AgQIECBAgAABAgQIEDCM/QABAgQIECBAgAABAgQIpAUM43T9whMgQIAAAQIECBAgQICAYewHCBAgQIAAAQIECBAgQCAtYBin6xeeAAECBAgQIECAAAECBAxjP0CAAAECBAgQIECAAAECaQHDOF2/8AQIECBAgAABAgQIECBgGPsBAgQIECBAgAABAgQIEEgLGMbp+oUnQIAAAQIECBAgQIAAAcPYDxAgQIAAAQIECBAgQIBAWsAwTtcvPAECBAgQIECAAAECBAgYxn6AAAECBAgQIECAAAECBNIChnG6fuEJECBAgAABAgQIECBAwDD2AwQIECBAgAABAgQIECCQFjCM0/ULT4AAAQIECBAgQIAAAQKGsR8gQIAAAQIECBAgQIAAgbSAYZyuX3gCBAgQIECAAAECBAgQMIz9AAECBAgQIECAAAECBAikBQzjdP3CEyBAgAABAgQIECBAgIBh7AcIECBAgAABAgQIECBAIC1gGKfrF54AAQIECBAgQIAAAQIEDGM/QIAAAQIECBAgQIAAAQJpAcM4Xb/wBAgQIECAAAECBAgQIGAY+wECBAgQIECAAAECBAgQSAsYxun6hSdAgAABAgQIECBAgAABw9gPECBAgAABAgQIECBAgEBawDBO1y88AQIECBAgQIAAAQIECBjGfoAAAQIECBAgQIAAAQIE0gKGcbp+4QkQIECAAAECBAgQIEDAMPYDBAgQIECAAAECBAgQIJAWMIzT9QtPgAABAgQIECBAgAABAoaxHyBAgAABAgQIECBAgACBtIBhnK5feAIECBAgQIAAAQIECBAwjP0AAQIECBAgQIAAAQIECKQFDON0/cITIECAAAECBAgQIECAgGHsBwgQIECAAAECBAgQIEAgLWAYp+sXngABAgQIECBAgAABAgQMYz9AgAABAgQIECBAgAABAmkBwzhdv/AECBAgQIAAAQIECBAgYBj7AQIECBAgQIAAAQIECBBICxjG6fqFJ0CAAAECBAgQIECAAAHD2A8QIECAAAECBAgQIECAQFrAME7XLzwBAgQIECBAgAABAgQIGMZ+gAABAgQIECBAgAABAgTSAoZxun7hCRAgQIAAAQIECBAgQMAw9gMECBAgQIAAAQIECBAgkBYwjNP1C0+AAAECBAgQIECAAAEChrEfIECAAAECBAgQIECAAIG0gGGcrl94AgQIECBAgAABAgQIEDCM/QABAgQIECBAgAABAgQIpAUM43T9whMgQIAAAQIECBAgQICAYewHCBAgQIAAAQIECBAgQCAtYBin6xeeAAECBAgQIECAAAECBAxjP0CAAAECBAgQIECAAAECaQHDOF2/8AQIECBAgAABAgQIECBgGPsBAgQIECBAgAABAgQIEEgLGMbp+oUnQIAAAQIECBAgQIAAAcPYDxAgQIAAAQIECBAgQIBAWsAwTtcvPAECBAgQIECAAAECBAgYxn6AAAECBAgQIECAAAECBNIChnG6fuEJECBAgAABAgQIECBAwDD2AwQIECBAgAABAgQIECCQFjCM0/ULT4AAAQIECBAgQIAAAQKGsR8gQIAAAQIECBAgQIAAgbSAYZyuX3gCBAgQIECAAAECBAgQMIz9AAECBAgQIECAAAECBAikBQzjdP3CEyBAgAABAgQIECBAgIBh7AcIECBAgAABAgQIECBAIC1gGKfrF54AAQIECBAgQIAAAQIEDGM/QIAAAQIECBAgQIAAAQJpAcM4Xb/wBAgQIECAAAECBAgQIGAY+wECBAgQIECAAAECBAgQSAsYxun6hSdAgAABAgQIECBAgAABw9gPECBAgAABAgQIECBAgEBawDBO1y88AQIECBAgQIAAAQIECBjGfoAAAQIECBAgQIAAAQIE0gKGcbp+4QkQIECAAAECBAgQIEDAMPYDBAgQIECAAAECBAgQIJAWMIzT9QtPgAABAgQIECBAgAABAoaxHyBAgAABAgQIECBAgACBtIBhnK5feAIECBAgQIAAAQIECBAwjP0AAQIECBAgQIAAAQIECKQFDON0/cITIECAAAECBAgQIECAgGHsBwgQIECAAAECBAgQIEAgLWAYp+sXngABAgQIECBAgAABAgQMYz9AgAABAgQIECBAgAABAmkBwzhdv/AECBAgQIAAAQIECBAgYBj7AQIECBAgQIAAAQIECBBICxjG6fqFJ0CAAAECBAgQIECAAAHD2A8QIECAAAECBAgQIECAQFrAME7XLzwBAgQIECBAgAABAgQIGMZ+gAABAgQIECBAgAABAgTSAoZxun7hCRAgQIAAAQIECBAgQMAw9gMECBAgQIAAAQIECBAgkBYwjNP1C0+AAAECBAgQIECAAAEChrEfIECAAAECBAgQIECAAIG0gGGcrl94AgQIECBAgAABAgQIEDCM/QABAgQIECBAgAABAgQIpAUM43T9whMgQIAAAQIECBAgQICAYewHCBAgQIAAAQIECBAgQCAtYBin6xeeAAECBAgQIECAAAECBAxjP0CAAAECBAgQIECAAAECaQHDOF2/8AQIECBAgAABAgQIECBgGPsBAgQIECBAgAABAgQIEEgLGMbp+oUnQIAAAQIECBAgQIAAAcPYDxAgQIAAAQIECBAgQIBAWsAwTtcvPAECBAgQIECAAAECBAgYxn6AAAECBAgQIECAAAECBNIChnG6fuEJECBAgAABAgQIECBAwDD2AwQIECBAgAABAgQIECCQFjCM0/ULT4AAAQIECBAgQIAAAQKGsR8gQIAAAQIECBAgQIAAgbSAYZyuX3gCBAgQIECAAAECBAgQMIz9AAECBAgQIECAAAECBAikBQzjdP3CEyBAgAABAgQIECBAgIBh7AcIECBAgAABAgQIECBAIC1gGKfrF54AAQIECBAgQIAAAQIEDGM/QIAAAQIECBAgQIAAAQJpAcM4Xb/wBAgQIECAAAECBAgQIGAY+wECBAgQIECAAAECBAgQSAsYxun6hSdAgAABAgQIECBAgAABw9gPECBAgAABAgQIECBAgEBawDBO1y88AQIECBAgQIAAAQIECBjGfoAAAQIECBAgQIAAAQIE0gKGcbp+4QkQIECAAAECBAgQIEDAMPYDBAgQIECAAAECBAgQIJAWMIzT9QtPgAABAgQIECBAgAABAoaxHyBAgAABAgQIECBAgACBtIBhnK5feAIECBAgQIAAAQIECBAwjP0AAQIECBAgQIAAAQIECKQFDON0/cITIECAAAECBAgQIECAgGHsBwgQIECAAAECBAgQIEAgLWAYp+sXngABAgQIECBAgAABAgQMYz9AgAABAgQIECBAgAABAmkBwzhdv/AECBAgQIAAAQIECBAgYBj7AQIECBAgQIAAAQIECBBICxjG6fqFJ0CAAAECBAgQIECAAAHD2A8QIECAAAECBAgQIECAQFrAME7XLzwBAgQIECBAgAABAgQIGMZ+gAABAgQIECBAgAABAgTSAoZxun7hCRAgQIAAAQIECBAgQMAw9gMECBAgQIAAAQIECBAgkBYwjNP1C0+AAAECBAgQIECAAAEChrEfIECAAAECBAgQIECAAIG0gGGcrl94AgQIECBAgAABAgQIEDCM/QABAgQIECBAgAABAgQIpAUM43T9whMgQIAAAQIECBAgQICAYewHCBAgQIAAAQIECBAgQCAtYBin6xeeAAECBAgQIECAAAECBAxjP0CAAAECBAgQIECAAAECaQHDOF2/8AQIECBAgAABAgQIECBgGPsBAgQIECBAgAABAgQIEEgLGMbp+oUnQIAAAQIECBAgQIAAAcPYDxAgQIAAAQIECBAgQIBAWsAwTtcvPAECBAgQIECAAAECBAgYxn6AAAECBAgQIECAAAECBNIChnG6fuEJECBAgAABAgQIECBAwDD2AwQIECBAgAABAgQIECCQFjCM0/ULT4AAAQIECBAgQIAAAQKGsR8gQIAAAQIECBAgQIAAgbSAYZyuX3gCBAgQIECAAAECBAgQMIz9AAECBAgQIECAAAECBAikBQzjdP3CEyBAgAABAgQIECBAgIBh7AcIECBAgAABAgQIECBAIC1gGKfrF54AAQIECBAgQIAAAQIEDGM/QIAAAQIECBAgQIAAAQJpAcM4Xb/wBAgQIECAAAECBAgQIGAY+wECBAgQIECAAAECBAgQSAsYxun6hSdAgAABAgQIECBAgAABw9gPECBAgAABAgQIECBAgEBawDBO1y88AQIECBAgQIAAAQIECDy4cQDz9jmcpAAAAABJRU5ErkJggg==';

		$UserSignature =new UserSignature;

		//print_r($_POST);
		//exit();
		if(!isset($_POST['terms'])){
			Yii::app()->user->setFlash('alert_fail', Yii::t("assets","You must accept the Terms & Conditions."));
				// $this->redirect(array('view','id'=>$model->Income82cId));
			$this->redirect($this->createUrl('/userSignature'));
		}
		
		if(isset($_POST['usersign'])  && $_POST['usersign'] != $blankimage)
		{

			$count = UserSignature::model()->countByAttributes(array(
            'user_id'=> Yii::app()->user->id
            ));
            if($count){
            	$Signature=UserSignature::model()->findByAttributes(array('user_id'=>Yii::app()->user->id));

				$Signature->signature = $_POST['usersign'];

				$Signature->save();
            }else{
	            $UserSignature->user_id =  Yii::app()->user->id;
				$UserSignature->signature =  $_POST['usersign'];
				$UserSignature->save();
			     //$_POST['user_id']
            }

            Yii::app()->user->setFlash('alert_success', Yii::t("assets","Successfully stored"));
				// $this->redirect(array('view','id'=>$model->Income82cId));
			$this->redirect($this->createUrl('/userSignature'));
		}else{

			Yii::app()->user->setFlash('alert_fail', Yii::t("assets","Please upload your signature"));
			$this->redirect($this->createUrl('/userSignature'));
			
		}
	}

	public function actionView($id)
	{
		$this->render('view',array(
			'model'=>$this->loadModel($id),
			));
	}


	/**
	* Creates a new model.
	* If creation is successful, the browser will be redirected to the 'view' page.
	*/


	/**
	* Lists all models.
	*/
	public function actionIndex()
	{
		$plan = $this->userCurrentPlan();
		 if(!isset($plan)){
		 	//$this->redirect($this->createUrl('/dashboard'));
		 }

		 if(isset($plan) && ($plan->plan_id==1||$plan->plan_id==2||$plan->plan_id==3)){
		 	//$this->redirect($this->createUrl('/dashboard'));
		 }

		$Signature=UserSignature::model()->findByAttributes(array('user_id'=>Yii::app()->user->id));
		$this->render('index',array(
			'title'=>"Title",
			'signature' =>$Signature
		));
	}



	
}
